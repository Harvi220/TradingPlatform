# üìã Backend Refactoring Plan

**Project:** Trading Platform - Binance Order Book Analyzer
**Version:** 1.1.0 ‚Üí 2.0.0
**Status:** üöÄ In Progress
**Created:** 2025-11-18

---

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- ‚úÖ **–ù–µ —Å–ª–æ–º–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üì¶ **DRY (Don't Repeat Yourself)** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üîß **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- üìä **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –∫–æ–¥ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üõ°Ô∏è **–¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- üé® **Consistency** - –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞

---

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ —Å–ª–æ—è–º**: API Routes ‚Üí Services ‚Üí Repositories ‚Üí Database
2. **Singleton –ø–∞—Ç—Ç–µ—Ä–Ω**: –¥–ª—è Prisma –∏ Redis –∫–ª–∏–µ–Ω—Ç–æ–≤
3. **–ë–∞—Ç—á–∏–Ω–≥**: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: 2-—É—Ä–æ–≤–Ω–µ–≤–æ–µ (Redis + PostgreSQL)
5. **TypeScript**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:

#### 1. **Magic Numbers –∏ Hardcoded Values**
```typescript
// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
private readonly BATCH_SIZE = 50;
private readonly BATCH_INTERVAL_MS = 60000; // 60 seconds
private readonly CACHE_TTL_SECONDS = 7200; // 2 hours
private readonly REQUEST_DELAY_MS = 300;
private readonly DEPTHS = [1.5, 3, 5, 8, 15, 30];
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–∞–π–ª–∞–º

#### 2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
- –ü–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª: `parseFloat()`, `parseInt()` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–µ–π –¥–ª—è Redis –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ timestamp –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

#### 3. **Error Handling**
```typescript
// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
try {
  // ...
} catch (error) {
  console.error('[SnapshotService] Error:', error);
  // –ù–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –Ω–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏
}
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫

#### 4. **Logging**
```typescript
// –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ª–æ–≥–æ–≤
console.log(`[SnapshotService] Flushed ${count} snapshots to DB`);
console.log(`[Collector] ‚úì ${symbol} ${marketType}`);
console.log('[Redis] Connected');
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### 5. **Validation**
```typescript
// API validation –≤ –∫–∞–∂–¥–æ–º route –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
if (!symbol || !depthParam) {
  return NextResponse.json({ error: 'MISSING_PARAMS' }, { status: 400 });
}
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤

#### 6. **Environment Variables**
```typescript
// –î–æ—Å—Ç—É–ø –∫ env vars —Ä–∞–∑–±—Ä–æ—Å–∞–Ω
process.env.REDIS_URL || 'redis://localhost:6379'
process.env.DATABASE_URL
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Ç–∏–ø–∞–º–∏

---

## üèóÔ∏è –§–∞–∑—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º)

### **Phase 1: Constants –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** ‚≠ê‚≠ê‚≠ê ‚úÖ COMPLETED

**–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/backend/constants/depths.constants.ts` - —Ç–æ—Ä–≥–æ–≤—ã–µ –≥–ª—É–±–∏–Ω—ã (1.4 KB)
2. ‚úÖ `src/backend/constants/collector.constants.ts` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞ (2.4 KB)
3. ‚úÖ `src/backend/constants/cache.constants.ts` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∞ (3.5 KB)
4. ‚úÖ `src/backend/constants/api.constants.ts` - API –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (4.3 KB)
5. ‚úÖ `src/backend/constants/database.constants.ts` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î (4.5 KB)
6. ‚úÖ `src/backend/constants/index.ts` - –æ–±—â–∏–π —ç–∫—Å–ø–æ—Ä—Ç (1.4 KB)

#### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ –í—ã–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –º–æ–¥—É–ª—è–º
- ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç
- ‚úÖ JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (17.5 KB –∫–æ–¥–∞)
- ‚úÖ –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ Type-safe –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑–∞—Ö

---

### **Phase 2: Utility —Ñ—É–Ω–∫—Ü–∏–∏** ‚≠ê‚≠ê‚≠ê ‚úÖ COMPLETED

**–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/backend/utils/common/parsers.ts` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (6.1 KB)
2. ‚úÖ `src/backend/utils/common/redis-keys.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Redis –∫–ª—é—á–µ–π (5.9 KB)
3. ‚úÖ `src/backend/utils/common/date.ts` - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ (7.9 KB)
4. ‚úÖ `src/backend/utils/common/formatters.ts` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (7.7 KB)
5. ‚úÖ `src/backend/utils/common/index.ts` - –æ–±—â–∏–π —ç–∫—Å–ø–æ—Ä—Ç (1.7 KB)

#### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª, –¥–∞—Ç, JSON (8 —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Redis –∫–ª—é—á–µ–π (9 —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ (20+ —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (15+ —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í—Å–µ —É—Ç–∏–ª–∏—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (29.3 KB –∫–æ–¥–∞)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ Type-safe –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑–∞—Ö

---

### **Phase 3: –¢–∏–ø–∏–∑–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** ‚≠ê‚≠ê‚≠ê ‚úÖ COMPLETED

**–í—Ä–µ–º—è:** ~20 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/backend/types/errors.types.ts` - —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ (5.3 KB)
2. ‚úÖ `src/backend/types/config.types.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (5.2 KB)
3. ‚úÖ `src/backend/types/redis.types.ts` - Redis —Ç–∏–ø—ã (5.4 KB)
4. ‚úÖ `src/backend/types/service.types.ts` - —Å–µ—Ä–≤–∏—Å—ã (6.6 KB)
5. ‚úÖ `src/backend/types/index.ts` - –æ–±—â–∏–π —ç–∫—Å–ø–æ—Ä—Ç (3.2 KB)

#### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ –¢–∏–ø—ã –¥–ª—è –æ—à–∏–±–æ–∫ –∏ error handling (10+ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- ‚úÖ –¢–∏–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (15+ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- ‚úÖ –¢–∏–ø—ã –¥–ª—è Redis –æ–ø–µ—Ä–∞—Ü–∏–π (15+ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- ‚úÖ –¢–∏–ø—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è (15+ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- ‚úÖ Type guards –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
- ‚úÖ Re-export —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∏–ø–æ–≤
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –±—ç–∫–µ–Ω–¥–∞ (25.7 KB –∫–æ–¥–∞)
- ‚úÖ Type-safe –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–≤—Å—é–¥—É
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç–∏–ø–æ–≤
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑–∞—Ö

---

### **Phase 4: Error Handling** ‚≠ê‚≠ê ‚úÖ COMPLETED

**–í—Ä–µ–º—è:** ~20 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/backend/utils/errors/AppError.ts` - –∫–ª–∞—Å—Å –æ—à–∏–±–∫–∏ (4.3 KB)
2. ‚úÖ `src/backend/utils/errors/errorFactory.ts` - —Ñ–∞–±—Ä–∏–∫–∞ –æ—à–∏–±–æ–∫ (9.0 KB)
3. ‚úÖ `src/backend/utils/errors/index.ts` - —ç–∫—Å–ø–æ—Ä—Ç (1.0 KB)

#### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ AppError –∫–ª–∞—Å—Å —Å –ø–æ–ª–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ 18 factory —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—à–∏–±–æ–∫:
  - Validation errors (5 —Ñ—É–Ω–∫—Ü–∏–π)
  - Database errors (2 —Ñ—É–Ω–∫—Ü–∏–∏)
  - Redis/Cache errors (2 —Ñ—É–Ω–∫—Ü–∏–∏)
  - Binance API errors (2 —Ñ—É–Ω–∫—Ü–∏–∏)
  - Collector errors (3 —Ñ—É–Ω–∫—Ü–∏–∏)
  - Generic errors (2 —Ñ—É–Ω–∫—Ü–∏–∏)
  - Error wrapping (2 —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ operational vs programming errors
- ‚úÖ JSON serialization –¥–ª—è API responses
- ‚úÖ Stack trace –≤ development —Ä–µ–∂–∏–º–µ
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (14.3 KB –∫–æ–¥–∞)
- ‚úÖ Type-safe error handling
- ‚úÖ –ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ—à–∏–±–∫–∞–º
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ services –∏ API routes

---

### **Phase 5: Logging Utility** ‚≠ê‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~20 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 4

#### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:
1. `src/backend/utils/logger/Logger.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
2. `src/backend/utils/logger/index.ts` - —ç–∫—Å–ø–æ—Ä—Ç

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```typescript
const logger = new Logger('SnapshotService');
logger.info('Flushed snapshots', { count: 50 });
logger.error('Database error', error);
```

---

### **Phase 6: Configuration Manager** ‚≠ê‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~15 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 5

#### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:
1. `src/backend/config/env.config.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä:
```typescript
export class EnvConfig {
  static readonly DATABASE_URL: string;
  static readonly REDIS_URL: string;
  static readonly NODE_ENV: 'development' | 'production';
  // ... —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Ç–∏–ø–∞–º–∏
}
```

---

### **Phase 7: API Validators** ‚≠ê‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~25 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 6

#### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:
1. `src/backend/middleware/validators/common.validator.ts`
2. `src/backend/middleware/validators/snapshot.validator.ts`
3. `src/backend/middleware/validators/index.ts`

---

### **Phase 8: Refactor Services** ‚≠ê‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~40 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 7

#### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:
1. `src/backend/services/snapshot.service.ts`
2. `src/backend/services/binance-rest-collector.ts`

---

### **Phase 9: Refactor Repositories** ‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~15 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 8

#### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:
1. `src/backend/repositories/snapshot.repository.ts`

---

### **Phase 10: Refactor API Routes** ‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 9

#### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:
1. `src/app/api/snapshots/route.ts`
2. `src/app/api/collector/route.ts`
3. `src/app/api/collector/symbols/route.ts`

---

### **Phase 11: Refactor Database Clients** ‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~20 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 10

#### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:
1. `src/backend/database/redis.client.ts`
2. `src/backend/database/prisma.client.ts`

---

### **Phase 12: Testing** ‚≠ê‚≠ê‚≠ê ‚è≥ PENDING

**–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç Phase 11

#### –ü—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚úÖ `npm run type-check`
2. ‚úÖ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
5. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

```
Phase 1:  ‚úÖ COMPLETED   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
Phase 2:  ‚úÖ COMPLETED   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
Phase 3:  ‚úÖ COMPLETED   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
Phase 4:  ‚úÖ COMPLETED   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
Phase 5:  ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 6:  ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 7:  ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 8:  ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 9:  ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 10: ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 11: ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%
Phase 12: ‚è≥ PENDING     [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0%

Overall: 33% ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
```

---

## üìÅ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

```
src/backend/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ binance.config.ts       # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ env.config.ts           # üÜï Phase 6
‚îÇ   ‚îî‚îÄ‚îÄ websocket.config.ts     # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ
‚îú‚îÄ‚îÄ constants/                   # üÜï Phase 1 - üöÄ IN PROGRESS
‚îÇ   ‚îú‚îÄ‚îÄ api.constants.ts
‚îÇ   ‚îú‚îÄ‚îÄ cache.constants.ts
‚îÇ   ‚îú‚îÄ‚îÄ collector.constants.ts
‚îÇ   ‚îú‚îÄ‚îÄ database.constants.ts
‚îÇ   ‚îú‚îÄ‚îÄ depths.constants.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ prisma.client.ts        # ‚úÖ ‚Üí üîß Phase 11
‚îÇ   ‚îî‚îÄ‚îÄ redis.client.ts         # ‚úÖ ‚Üí üîß Phase 11
‚îÇ
‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îî‚îÄ‚îÄ snapshot.repository.ts  # ‚úÖ ‚Üí üîß Phase 9
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ snapshot.service.ts     # ‚úÖ ‚Üí üîß Phase 8
‚îÇ   ‚îú‚îÄ‚îÄ binance-rest-collector.ts # ‚úÖ ‚Üí üîß Phase 8
‚îÇ   ‚îî‚îÄ‚îÄ binance/
‚îÇ       ‚îú‚îÄ‚îÄ OrderBookService.ts # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ       ‚îî‚îÄ‚îÄ WebSocketService.ts # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ binance.types.ts        # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ indicators.types.ts     # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ orderBook.types.ts      # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ api.types.ts            # üÜï Phase 3
‚îÇ   ‚îú‚îÄ‚îÄ config.types.ts         # üÜï Phase 3
‚îÇ   ‚îú‚îÄ‚îÄ errors.types.ts         # üÜï Phase 3
‚îÇ   ‚îú‚îÄ‚îÄ redis.types.ts          # üÜï Phase 3
‚îÇ   ‚îú‚îÄ‚îÄ service.types.ts        # üÜï Phase 3
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                # üÜï Phase 3
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ calculations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ depthCalculator.ts  # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ diffCalculator.ts   # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ helpers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ priceHelper.ts      # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ orderBookValidator.ts # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ common/                 # üÜï Phase 2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parsers.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis-keys.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ date.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ errors/                 # üÜï Phase 4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppError.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorFactory.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ logger/                 # üÜï Phase 5
‚îÇ       ‚îú‚îÄ‚îÄ Logger.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ
‚îî‚îÄ‚îÄ middleware/                 # üÜï Phase 7
    ‚îî‚îÄ‚îÄ validators/
        ‚îú‚îÄ‚îÄ snapshot.validator.ts
        ‚îú‚îÄ‚îÄ common.validator.ts
        ‚îî‚îÄ‚îÄ index.ts
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- Magic numbers: **~15 –º–µ—Å—Ç**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞: **~8 –º–µ—Å—Ç**
- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏: **~10 –º–µ—Å—Ç**
- –ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏: **~20 –º–µ—Å—Ç**
- Type safety: **70%**

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- Magic numbers: **0** ‚úÖ
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞: **0** ‚úÖ
- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏: **0** ‚úÖ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏: **100%** ‚úÖ
- Type safety: **95%+** ‚úÖ

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ß—Ç–æ –ø–æ–ª—É—á–∏–º:
1. ‚úÖ **–ß–∏—Å—Ç—ã–π –∫–æ–¥** - –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
2. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤** - –º–µ–Ω—å—à–µ runtime –æ—à–∏–±–æ–∫
3. ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - DRY –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥–µ–Ω
4. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏** - –ª–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
5. ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤–µ–∑–¥–µ
6. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤–æ–µ

### –ì–∞—Ä–∞–Ω—Ç–∏–∏:
- ‚ö†Ô∏è **–ù–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–Ω–æ** - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥—É—Ç
- ‚ö†Ô∏è **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - API –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è
- ‚ö†Ô∏è **Production ready** - –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –¥–µ–ø–ª–æ–∏—Ç—å

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ –ù–ï –±—É–¥–µ–º —Ç—Ä–æ–≥–∞—Ç—å:
- ‚ùå Frontend –∫–æ–¥ (—Ç–æ–ª—å–∫–æ backend)
- ‚ùå Database schema (Prisma migrations)
- ‚ùå Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚ùå Legacy WebSocket services (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

### –ù–∞ –±—É–¥—É—â–µ–µ (v2.1.0):
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- [ ] Performance monitoring
- [ ] Grafana dashboards

---

**Total estimated time: ~4.5 hours**
**Risk level: Low** (—Ç–æ–ª—å–∫–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
**Breaking changes: None**

---

‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω!**
